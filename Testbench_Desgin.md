# Testbench Desgin

该文档用来说明Cache开发中的testbench的主要构造以及相关信息。

写在开头：设计好一个优秀的Testbench是非常难的，但是其重要性在大规模项目中显得格外重要，虽然龙芯具有完整CPU的testbench，但是本着独立开发，不给团队添乱的宗旨，我们还是要事先进行相关的测试，在大程度上保证整个Cache不能够出错，所以我们应该要进行基本功能和冲突例外鲁棒验证。

## Interface

#### 基本功能

##### ICache从主存中读取块，验证是否成功将返回的字包装成块，并且完成时返回相应的完成信号。

设置读使能和地址，接下来八次，每次等待。

发现问题：

- 时序问题，给Cache的数据传输成功信号采用组合逻辑，使得还没有真正成功的时候就输出了成功信号，现在应该将其改为时序逻辑。
- 时序问题，在某个字进行读取的时候，还没有等到返回正确数据就写入了总线的数据，这将导致打包块的最后一个数据的时候错误的将第一个字置为最后一个字。

##### DCache从主存中读取块，验证是否成功将返回的字包装成块，并且完成时返回相应的完成信号。

##### DCache从主存中写入块，验证是否成功将写入的块拆成字，并且完成时返回相应的完成信号。

#### 鲁棒验证

##### 当ICache和Dache同时读时，判定是否让DCache先读，同时在这个过程中是否信号正常。

##### 在ICache读时若遇见DCache读，是否能够让ICache返回，并且DCache信号正常。

##### 读写同时进行。



### WriteFIFO

#### 基本功能

##### 写入一个块，模拟总线的交互，看FIFO状态是否跳转成工作状态，并且送出的数据是否对应。之后设置写入完成信号，观察是否成功跳转为空状态，队头队尾指针是否正确。

##### 连续写入9个地址不同的块，看FIFO能否成功跳转至满状态。在队列中国有多个块的时候能否成功进行主存写操作。

##### 在上一个测试中途加入三个块的读操作，一个命中一个不命中再有一个命中失效单元。

#### 鲁棒验证

##### 读操作命中现在正在写的块 。